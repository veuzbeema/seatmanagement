<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management - Seating System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --success-dark: #059669;
            --purple: #a855f7;
            --orange: #f59e0b;
            --text: #1f2937;
            --text-secondary: #6b7280;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --info: #3b82f6;
            --info-dark: #2563eb;
            --danger: #ef4444;
            --danger-dark: #b91c1c;
            --gray: #9ca3af;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #dcdcdc 0%, #000000 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-30px) translateX(20px); }
            50% { transform: translateY(-60px) translateX(-20px); }
            75% { transform: translateY(-30px) translateX(30px); }
        }

        /* Navbar */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            padding: 16px 32px;
            position: relative;
            z-index: 100;
        }

        .navbar-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo img {
            height: 40px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .user-badge i {
            font-size: 16px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            z-index: 10;
        }

        .dashboard-container {
            max-width: 1200px;
            width: 100%;
        }

        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .module-title {
            font-size: 2.2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0;
            text-shadow: 2px 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-create {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            padding: 10px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
            transition: all 0.3s ease;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
        }

        .btn-create i {
            margin-right: 8px;
        }

        /* User Table */
        .user-table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-box {
            position: relative;
            max-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border-radius: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
        }

        .search-box input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-box i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.8);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(245, 158, 11, 0.1);
        }

        th {
            padding: 16px 24px;
            text-align: left;
            font-weight: 700;
            color: var(--text);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 16px 24px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            color: var(--text);
            font-size: 1rem;
        }

        tr:hover {
            background: rgba(245, 158, 11, 0.05);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 12px;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-email {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .role-admin {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .role-manager {
            background: rgba(59, 130, 246, 0.15);
            color: var(--info);
        }

        .role-staff {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .status-active {
            color: var(--success);
            font-weight: 600;
        }

        .status-inactive {
            color: var(--text-secondary);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.05);
            color: var(--text);
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-action:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .btn-edit:hover {
            background: var(--info);
        }

        .btn-delete:hover {
            background: var(--danger);
        }

        /* Stats Section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 32px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        /* Permissions Section */
        .permissions-section {
            margin-top: 24px;
            padding: 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .permissions-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .permissions-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
        }

        .permission-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .permission-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .permission-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 20px;
            color: white;
        }

        .manage-seats .permission-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .print-badges .permission-icon {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .user-management .permission-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .badge-alignment .permission-icon {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .permission-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0;
        }

        .permission-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .permission-checkboxes {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-check-input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .form-check-label {
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .module-title {
                font-size: 1.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-action {
                width: 100%;
                height: auto;
                padding: 8px;
                justify-content: flex-start;
            }
            
            .stats-section {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .permissions-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            .module-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            th, td {
                padding: 12px;
            }
        }


    .role-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }
    .role-admin { background: #dc3545; color: white; }
    .role-manager { background: #ffc107; color: black; }
    .role-staff { background: #198754; color: white; }
    .status-active { background: #d4edda; color: #155724; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }
    .status-inactive { background: #f8d7da; color: #721c24; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }
    .user-avatar { width: 36px; height: 36px; background: #0d6efd; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; }

    </style>
</head>
<body>
    <form style="display:none;" id="csrf-form">{% csrf_token %}</form>
    <!-- Animated Background Particles -->
    <div class="particles">
        <div class="particle" style="width: 60px; height: 60px; top: 10%; left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="width: 40px; height: 40px; top: 20%; left: 80%; animation-delay: 2s;"></div>
        <div class="particle" style="width: 80px; height: 80px; top: 60%; left: 15%; animation-delay: 4s;"></div>
        <div class="particle" style="width: 50px; height: 50px; top: 70%; left: 85%; animation-delay: 1s;"></div>
        <div class="particle" style="width: 70px; height: 70px; top: 40%; left: 50%; animation-delay: 3s;"></div>
        <div class="particle" style="width: 55px; height: 55px; top: 85%; left: 30%; animation-delay: 5s;"></div>
        <div class="particle" style="width: 45px; height: 45px; top: 5%; left: 60%; animation-delay: 6s;"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo">
                <img src="https://www.eventxpro.com/images/logos/logo.png" alt="EventXPro">
            </div>
            <div class="user-badge">
                <i class="fas fa-user-shield"></i>
                <span>Admin</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
<div class="main-content">
    <div class="dashboard-container">
        <!-- Module Header -->
        <div class="module-header">
            <h1 class="module-title">User Management</h1>
            <button class="btn-create" data-bs-toggle="modal" data-bs-target="#createUserModal"
            
            {% if 'create' not in permissions %}
                disabled
                data-bs-toggle="tooltip"
                data-bs-placement="top"
                title="You do not have permission to create seats"
            {% endif %}
            >
                <i class="fas fa-plus"></i> Create User
            </button>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="stat-total">0</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-admins">0</div>
                <div class="stat-label">Admins</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-managers">0</div>
                <div class="stat-label">Managers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-staff">0</div>
                <div class="stat-label">Staff</div>
            </div>
        </div>
        <br>

        <!-- User Table -->
        <div class="user-table-container">
            <div class="table-header">
                <div>Users (<span id="user-count">0</span>)</div>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search users...">
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- Filled by JS -->
                </tbody>
            </table>
        </div>
    </div>
</div>

            <!-- Permissions Section -->
    
      
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createUserModalLabel">Create New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="userName" placeholder="Enter full name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userEmail" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="userEmail" placeholder="Enter email" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userRole" class="form-label">Role</label>
                                <select class="form-select" id="userRole" required>
                                    <option value="">Select role</option>
                                    <option value="admin">Admin</option>
                                    <option value="manager" selected>Manager</option>
                                    <option value="staff">Staff</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="userPassword" placeholder="Enter password" required>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="userStatus" checked>
                            <label class="form-check-label" for="userStatus">Active User</label>
                        </div>
                        
                        <!-- Permissions Section in Modal -->
                        <div class="mt-4">
                            <h6 class="mb-3">Module Permissions</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h6 class="card-title"><i class="fas fa-keyboard me-2 text-primary"></i>Manage Seats</h6>
                                           <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalSeatView" checked>
                                                <label class="form-check-label" for="createModalSeatView">View</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalSeatEdit" checked>
                                                <label class="form-check-label" for="createModalSeatEdit">Edit</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalSeatCreate">
                                                <label class="form-check-label" for="createModalSeatCreate">Create</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalSeatUpload">
                                                <label class="form-check-label" for="createModalSeatUpload">Upload</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalSeatDelete">
                                                <label class="form-check-label" for="createModalSeatDelete">Delete</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h6 class="card-title"><i class="fas fa-print me-2 text-success"></i>Print Badges</h6>
                                           <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalBadgeView" checked>
                                                <label class="form-check-label" for="createModalBadgeView">View</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalBadgePrint" checked>
                                                <label class="form-check-label" for="createModalBadgePrint">Print</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalBadgeExport">
                                                <label class="form-check-label" for="createModalBadgeExport">Export</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h6 class="card-title"><i class="fas fa-users me-2 text-warning"></i>User Management</h6>
                                           <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalUserView" checked>
                                                <label class="form-check-label" for="createModalUserView">View</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalUserCreate" checked>
                                                <label class="form-check-label" for="createModalUserCreate">Create</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalUserEdit" checked>
                                                <label class="form-check-label" for="createModalUserEdit">Edit</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalUserDelete">
                                                <label class="form-check-label" for="createModalUserDelete">Delete</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h6 class="card-title"><i class="fas fa-ruler-combined me-2 text-info"></i>Badge Alignment</h6>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalAlignView" checked>
                                                <label class="form-check-label" for="createModalAlignView">View</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalAlignEdit" checked>
                                                <label class="form-check-label" for="createModalAlignEdit">Edit</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="createModalAlignReset">
                                                <label class="form-check-label" for="createModalAlignReset">Reset</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnSaveCreate">Create User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editUserName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="editUserName" placeholder="Enter full name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editUserEmail" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="editUserEmail" placeholder="Enter email" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editUserRole" class="form-label">Role</label>
                            <select class="form-select" id="editUserRole" required>
                                <option value="">Select role</option>
                                <option value="admin">Admin</option>
                                <option value="manager">Manager</option>
                                <option value="staff">Staff</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editUserPassword" class="form-label">New Password (optional)</label>
                            <input type="password" class="form-control" id="editUserPassword" placeholder="Leave blank to keep current">
                        </div>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="editUserStatus" checked>
                        <label class="form-check-label" for="editUserStatus">Active User</label>
                    </div>
                    
                    <!-- Permissions Section in Modal -->
                    <div class="mt-4">
                        <h6 class="mb-3">Module Permissions</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h6 class="card-title"><i class="fas fa-keyboard me-2 text-primary"></i>Manage Seats</h6>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalSeatView" checked>
                                            <label class="form-check-label" for="editModalSeatView">View</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalSeatEdit" checked>
                                            <label class="form-check-label" for="editModalSeatEdit">Edit</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalSeatCreate">
                                            <label class="form-check-label" for="editModalSeatCreate">Create</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalSeatUpload">
                                            <label class="form-check-label" for="editModalSeatUpload">Upload</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalSeatDelete">
                                            <label class="form-check-label" for="editModalSeatDelete">Delete</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h6 class="card-title"><i class="fas fa-print me-2 text-success"></i>Print Badges</h6>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalBadgeView" checked>
                                            <label class="form-check-label" for="editModalBadgeView">View</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalBadgePrint" checked>
                                            <label class="form-check-label" for="editModalBadgePrint">Print</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalBadgeExport">
                                            <label class="form-check-label" for="editModalBadgeExport">Export</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h6 class="card-title"><i class="fas fa-users me-2 text-warning"></i>User Management</h6>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalUserView" checked>
                                            <label class="form-check-label" for="editModalUserView">View</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalUserCreate" checked>
                                            <label class="form-check-label" for="editModalUserCreate">Create</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalUserEdit" checked>
                                            <label class="form-check-label" for="editModalUserEdit">Edit</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalUserDelete">
                                            <label class="form-check-label" for="editModalUserDelete">Delete</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h6 class="card-title"><i class="fas fa-ruler-combined me-2 text-info"></i>Badge Alignment</h6>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalAlignView" checked>
                                            <label class="form-check-label" for="editModalAlignView">View</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalAlignEdit" checked>
                                            <label class="form-check-label" for="editModalAlignEdit">Edit</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editModalAlignReset">
                                            <label class="form-check-label" for="editModalAlignReset">Reset</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" id="btnSaveEdit">Update User</button>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>



       const API = {
        list: "{% url 'accounts:list_users' %}",
        create: "{% url 'accounts:create_user' %}",
        update: (id) => "{% url 'accounts:update_user' 999 %}".replace('999', id),
        delete: (id) => "{% url 'accounts:delete_user' 999 %}".replace('999', id)
    };


    const createModal = new bootstrap.Modal(document.getElementById('createUserModal'));
    const editModal = new bootstrap.Modal(document.getElementById('editUserModal'));
    // const modal = new bootstrap.Modal(document.getElementById('createUserModal'));
    let editingUserId = null;

    // Load users + stats
    function loadUsers() {
        fetch(API.list)
            .then(r => r.json())
            .then(data => {
                // Update stats
                document.getElementById('stat-total').textContent = data.stats.total;
                document.getElementById('stat-admins').textContent = data.stats.admins;
                document.getElementById('stat-managers').textContent = data.stats.managers;
                document.getElementById('stat-staff').textContent = data.stats.staff;
                document.getElementById('user-count').textContent = data.stats.total;

                // Update table
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = '';
                data.users.forEach(u => {
                    const initials = u.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">${initials}</div>
                                <div>
                                    <div class="user-name">${u.name}</div>
                                    <div class="user-email">${u.email}</div>
                                </div>
                            </div>
                        </td>
                        <td><span class="role-badge role-${u.role}">${u.role.charAt(0).toUpperCase() + u.role.slice(1)}</span></td>
                        <td><span class="status-${u.status}">${u.status.charAt(0).toUpperCase() + u.status.slice(1)}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-action btn-edit" data-id="${u.id}" title="Edit"
                                   {% if 'edit' not in permissions %}
                                        disabled
                                        data-bs-toggle="tooltip"
                                        data-bs-placement="top"
                                        title="You do not have permission to create seats"
                                    {% endif %}
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-action btn-delete" data-id="${u.id}" title="Delete"
                                {% if 'delete' not in permissions %}
                                        disabled
                                        data-bs-toggle="tooltip"
                                        data-bs-placement="top"
                                        title="You do not have permission to create seats"
                                    {% endif %}
                                >
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                attachActionListeners();
            });
    }

    function attachActionListeners() {
        document.querySelectorAll('.btn-edit').forEach(btn => {
            btn.onclick = () => editUser(btn.dataset.id);
        });
        document.querySelectorAll('.btn-delete').forEach(btn => {
            btn.onclick = () => deleteUser(btn.dataset.id);
        });
    }

function editUser(id) {
        fetch(API.list).then(r => r.json()).then(data => {
            const user = data.users.find(u => u.id == id);
            if (!user) return;

            editingUserId = id;
            document.getElementById('editUserName').value = user.name;
            document.getElementById('editUserEmail').value = user.email;
            document.getElementById('editUserRole').value = user.role;
            document.getElementById('editUserStatus').checked = String(user.status).toLowerCase() === 'active';
            document.getElementById('editUserPassword').value = ''; // Clear password

            // Reset checkboxes in edit modal
            document.querySelectorAll('#editUserModal input[type="checkbox"]').forEach(cb => cb.checked = false);
            Object.keys(user.permissions).forEach(key => {
                const [module, action] = key.split('_');
                const cbId = `editModal${module.charAt(0).toUpperCase() + module.slice(1)}${action.charAt(0).toUpperCase() + action.slice(1)}`;
                const cb = document.getElementById(cbId);
                if (cb) cb.checked = true;
            });

            editModal.show();
        });
    }

    function deleteUser(id) {
        if (!confirm('Delete this user?')) return;
        fetch(API.delete(id), { method: 'DELETE' })
            .then(r => r.json())
            .then(res => {
                if (res.success) loadUsers();
                else alert('Delete failed');
            });
    }

        // Save Create
        document.getElementById('btnSaveCreate').onclick = () => saveUser(false);

        // Save Update
        document.getElementById('btnSaveEdit').onclick = () => saveUser(true);

        function saveUser(isEdit) {
            const modalId = isEdit ? 'editUserModal' : 'createUserModal';
            const prefix = isEdit ? 'editModal' : 'createModal';
            const nameId = isEdit ? 'editUserName' : 'userName';
            const emailId = isEdit ? 'editUserEmail' : 'userEmail';
            const roleId = isEdit ? 'editUserRole' : 'userRole';
            const statusId = isEdit ? 'editUserStatus' : 'userStatus';
            const passwordId = isEdit ? 'editUserPassword' : 'userPassword';

            const data = {
                name: document.getElementById(nameId).value.trim(), // Assuming backend expects 'name' from full name
                email: document.getElementById(emailId).value.trim(),
                password: document.getElementById(passwordId).value || undefined,
                role: document.getElementById(roleId).value,
                status: document.getElementById(statusId).checked ? 'active' : 'inactive',
                permissions: []
            };

            if (!data.email || !data.role) {
                alert('Email and Role are required');
                return;
            }

            // Collect permissions
            document.querySelectorAll(`#${modalId} input[type="checkbox"]:checked`).forEach(cb => {
                const match = cb.id.match(new RegExp(`${prefix}([A-Z][a-z]+)([A-Z][a-z]+)`));
                if (match) {
                    data.permissions.push({
                        module: match[1].toLowerCase(),
                        action: match[2].toLowerCase()
                    });
                }
            });

            const url = isEdit ? API.update(editingUserId) : API.create;
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('input[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify(data)
            })
            .then(r => r.json())
            .then(res => {
                if (res.success) {
                    (isEdit ? editModal : createModal).hide();
                    loadUsers();
                    if (!isEdit) resetCreateForm();
                    editingUserId = null;
                } else {
                    alert(res.error || 'Save failed');
                }
            });
        }

        function resetCreateForm() {
            document.querySelector('#createUserModal form').reset();
            // Reset checkboxes with defaults
            document.getElementById('createModalSeatView').checked = true;
            document.getElementById('createModalSeatEdit').checked = true;
            document.getElementById('createModalBadgeView').checked = true;
            document.getElementById('createModalBadgePrint').checked = true;
            document.getElementById('createModalUserView').checked = true;
            document.getElementById('createModalUserCreate').checked = true;
            document.getElementById('createModalUserEdit').checked = true;
            document.getElementById('createModalAlignView').checked = true;
            document.getElementById('createModalAlignEdit').checked = true;
            // Others remain unchecked
        }

    // Search
    document.getElementById('searchInput').oninput = (e) => {
        const term = e.target.value.toLowerCase();
        document.querySelectorAll('#userTableBody tr').forEach(tr => {
            const text = tr.textContent.toLowerCase();
            tr.style.display = text.includes(term) ? '' : 'none';
        });
    };

    // Reset modal
   document.getElementById('createUserModal').addEventListener('hidden.bs.modal', () => {
        resetCreateForm();
    });
    document.getElementById('editUserModal').addEventListener('hidden.bs.modal', () => {
        document.querySelector('#editUserModal form').reset();
        editingUserId = null;
    });

    // Initial load
    loadUsers();


 // Automatically disable module permissions when "View" is unchecked (for both modals)
['createModal', 'editModal'].forEach(prefix => {
    document.querySelectorAll(`[id^="${prefix}"][id$="View"]`).forEach(viewCheckbox => {
        viewCheckbox.addEventListener('change', function() {
            const modalId = this.closest('.modal').id;
            const card = this.closest('.card-body');
            const allCheckboxes = card.querySelectorAll(`input[type="checkbox"]:not(#${this.id})`);
            
            if (!this.checked) {
                allCheckboxes.forEach(cb => {
                    cb.checked = false;
                    cb.disabled = true;
                });
            } else {
                allCheckboxes.forEach(cb => cb.disabled = false);
            }
        });

        // Run once on load
        const card = viewCheckbox.closest('.card-body');
        const allCheckboxes = card.querySelectorAll(`input[type="checkbox"]:not(#${viewCheckbox.id})`);
        if (!viewCheckbox.checked) {
            allCheckboxes.forEach(cb => {
                cb.checked = false;
                cb.disabled = true;
            });
        }
    });
});


    </script>
</body>
</html>